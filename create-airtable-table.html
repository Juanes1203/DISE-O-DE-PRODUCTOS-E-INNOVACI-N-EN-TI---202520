<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèóÔ∏è Crear Tabla Airtable desde Cero</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .section { background: rgba(255,255,255,0.1); padding: 20px; margin: 20px 0; border-radius: 10px; }
        .btn { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #218838; }
        .btn.warning { background: #ffc107; color: black; }
        .btn.warning:hover { background: #e0a800; }
        .btn.danger { background: #dc3545; }
        .btn.danger:hover { background: #c82333; }
        .result { background: rgba(0,0,0,0.3); padding: 15px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .error { background: rgba(220,53,69,0.3); }
        .success { background: rgba(40,167,69,0.3); }
        .info { background: rgba(23,162,184,0.3); }
        .warning { background: rgba(255,193,7,0.3); }
        .field-info { background: rgba(108,117,125,0.3); margin: 10px 0; padding: 10px; border-radius: 5px; }
        .field-info h4 { margin: 0 0 5px 0; color: #ffc107; }
    </style>
</head>
<body>
    <h1>üèóÔ∏è Crear Tabla Airtable desde Cero</h1>
    
    <div class="section">
        <h3>üìã Estructura Ideal de la Tabla</h3>
        <div class="field-info">
            <h4>üìù Campo: Nombre</h4>
            <p>Tipo: Single line text</p>
            <p>Descripci√≥n: Nombre completo del estudiante</p>
            <p>Ejemplo: "Alcala Gonzalez, Sofia"</p>
        </div>
        <div class="field-info">
            <h4>üìÖ Campo: Fecha</h4>
            <p>Tipo: Date</p>
            <p>Descripci√≥n: Fecha de la clase</p>
            <p>Ejemplo: "2025-01-15"</p>
        </div>
        <div class="field-info">
            <h4>‚úÖ Campo: Estado</h4>
            <p>Tipo: Single select</p>
            <p>Opciones: "present", "absent"</p>
            <p>Descripci√≥n: Estado de asistencia del estudiante</p>
        </div>
        <div class="field-info">
            <h4>üë§ Campo: Usuario Registro</h4>
            <p>Tipo: Single line text</p>
            <p>Descripci√≥n: Usuario que registr√≥ la asistencia</p>
            <p>Ejemplo: "prof.arturo.gomez"</p>
        </div>
        <div class="field-info">
            <h4>üé≠ Campo: Rol Usuario</h4>
            <p>Tipo: Single line text</p>
            <p>Descripci√≥n: Rol del usuario que registr√≥</p>
            <p>Ejemplo: "Profesor Principal"</p>
        </div>
        <div class="field-info">
            <h4>‚è∞ Campo: Timestamp</h4>
            <p>Tipo: Date time</p>
            <p>Descripci√≥n: Fecha y hora exacta del registro</p>
            <p>Ejemplo: "2025-01-15T10:30:00.000Z"</p>
        </div>
        <div class="field-info">
            <h4>üìö Campo: Curso</h4>
            <p>Tipo: Single line text</p>
            <p>Descripci√≥n: Nombre del curso</p>
            <p>Ejemplo: "ISIS2007 - Dise√±o de Productos e Innovaci√≥n en TI"</p>
        </div>
    </div>
    
    <div class="section">
        <h3>üîß Pasos para Crear la Tabla</h3>
        <ol>
            <li><strong>Ve a Airtable</strong> y abre tu base de datos</li>
            <li><strong>Crea una nueva tabla</strong> llamada "Asistencia"</li>
            <li><strong>Agrega los campos</strong> seg√∫n la estructura de arriba</li>
            <li><strong>Configura los tipos</strong> correctamente</li>
            <li><strong>Guarda la tabla</strong></li>
        </ol>
    </div>
    
    <div class="section">
        <h3>üß™ Test de la Nueva Tabla</h3>
        <button class="btn" onclick="testNewTable()">Probar Nueva Tabla</button>
        <button class="btn warning" onclick="createSampleData()">Crear Datos de Prueba</button>
        <button class="btn danger" onclick="clearAllData()">Limpiar Todos los Datos</button>
        <div id="test-result" class="result"></div>
    </div>
    
    <div class="section">
        <h3>üìù Configuraci√≥n Actualizada</h3>
        <button class="btn" onclick="showUpdatedConfig()">Mostrar Configuraci√≥n</button>
        <div id="config-result" class="result"></div>
    </div>

    <script src="airtable-config.js"></script>
    
    <script>
        function addResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            element.className = `result ${type}`;
        }

        async function testNewTable() {
            try {
                addResult('test-result', 'üîÑ Probando nueva tabla...', 'info');
                
                // Test de conexi√≥n b√°sica
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${encodeURIComponent(AIRTABLE_CONFIG.TABLE_NAME)}?maxRecords=1`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.records && data.records.length > 0) {
                        const record = data.records[0];
                        const fields = Object.keys(record.fields);
                        
                        let result = '‚úÖ Tabla encontrada y funcionando:\n\n';
                        result += 'Campos detectados:\n';
                        fields.forEach(field => {
                            result += `- "${field}": ${typeof record.fields[field]}\n`;
                        });
                        
                        result += '\nEjemplo de registro:\n';
                        result += JSON.stringify(record.fields, null, 2);
                        
                        addResult('test-result', result, 'success');
                    } else {
                        addResult('test-result', '‚ÑπÔ∏è Tabla creada pero vac√≠a. Lista para recibir datos.', 'info');
                    }
                } else {
                    const errorText = await response.text();
                    addResult('test-result', `‚ùå Error ${response.status}: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult('test-result', `Error: ${error.message}`, 'error');
            }
        }

        async function createSampleData() {
            try {
                addResult('test-result', 'üîÑ Creando datos de prueba...', 'info');
                
                const sampleRecords = [
                    {
                        fields: {
                            'Nombre': 'Alcala Gonzalez, Sofia',
                            'Fecha': '2025-01-15',
                            'Estado': 'present',
                            'Usuario Registro': 'prof.arturo.gomez',
                            'Rol Usuario': 'Profesor Principal',
                            'Timestamp': new Date().toISOString(),
                            'Curso': 'ISIS2007 - Dise√±o de Productos e Innovaci√≥n en TI'
                        }
                    },
                    {
                        fields: {
                            'Nombre': 'Aristizabal Garcia, Gabriel',
                            'Fecha': '2025-01-15',
                            'Estado': 'absent',
                            'Usuario Registro': 'prof.arturo.gomez',
                            'Rol Usuario': 'Profesor Principal',
                            'Timestamp': new Date().toISOString(),
                            'Curso': 'ISIS2007 - Dise√±o de Productos e Innovaci√≥n en TI'
                        }
                    },
                    {
                        fields: {
                            'Nombre': 'Avila Nivia, Juan Sebastian',
                            'Fecha': '2025-01-15',
                            'Estado': 'present',
                            'Usuario Registro': 'prof.arturo.gomez',
                            'Rol Usuario': 'Profesor Principal',
                            'Timestamp': new Date().toISOString(),
                            'Curso': 'ISIS2007 - Dise√±o de Productos e Innovaci√≥n en TI'
                        }
                    }
                ];
                
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${encodeURIComponent(AIRTABLE_CONFIG.TABLE_NAME)}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: sampleRecords
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    addResult('test-result', `‚úÖ Datos de prueba creados exitosamente:\n${result.records.length} registros agregados`, 'success');
                } else {
                    const errorText = await response.text();
                    addResult('test-result', `‚ùå Error ${response.status}: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult('test-result', `Error: ${error.message}`, 'error');
            }
        }

        async function clearAllData() {
            try {
                addResult('test-result', 'üîÑ Limpiando todos los datos...', 'info');
                
                // Primero obtener todos los registros
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${encodeURIComponent(AIRTABLE_CONFIG.TABLE_NAME)}?maxRecords=1000`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.records && data.records.length > 0) {
                        // Eliminar cada registro
                        for (const record of data.records) {
                            await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${encodeURIComponent(AIRTABLE_CONFIG.TABLE_NAME)}/${record.id}`, {
                                method: 'DELETE',
                                headers: {
                                    'Authorization': `Bearer ${AIRTABLE_CONFIG.API_KEY}`
                                }
                            });
                        }
                        
                        addResult('test-result', `‚úÖ ${data.records.length} registros eliminados`, 'success');
                    } else {
                        addResult('test-result', '‚ÑπÔ∏è No hay datos para limpiar', 'info');
                    }
                } else {
                    const errorText = await response.text();
                    addResult('test-result', `‚ùå Error ${response.status}: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult('test-result', `Error: ${error.message}`, 'error');
            }
        }

        function showUpdatedConfig() {
            const config = `// Configuraci√≥n actualizada para la nueva tabla
const AIRTABLE_CONFIG = {
    API_KEY: '${AIRTABLE_CONFIG.API_KEY}',
    BASE_ID: '${AIRTABLE_CONFIG.BASE_ID}',
    TABLE_NAME: 'Asistencia',
    BASE_URL: 'https://api.airtable.com/v0',
    FIELDS: {
        NOMBRE: 'Nombre',
        FECHA: 'Fecha',
        ESTADO: 'Estado',
        USUARIO_REGISTRO: 'Usuario Registro',
        ROL_USUARIO: 'Rol Usuario',
        TIMESTAMP: 'Timestamp',
        CURSO: 'Curso'
    }
};

// Instrucciones para crear la tabla en Airtable:
// 1. Crear nueva tabla llamada "Asistencia"
// 2. Agregar campos con los nombres exactos de arriba
// 3. Configurar tipos: Text (Nombre, Usuario Registro, Rol Usuario, Curso)
// 4. Configurar tipos: Date (Fecha), Date time (Timestamp)
// 5. Configurar tipos: Single select (Estado) con opciones: "present", "absent"
// 6. Guardar la tabla

// Esta configuraci√≥n deber√≠a funcionar perfectamente con la nueva tabla.`;

            addResult('config-result', config, 'success');
        }

        // Auto-ejecutar al cargar
        window.onload = function() {
            showUpdatedConfig();
        };
    </script>
</body>
</html> 